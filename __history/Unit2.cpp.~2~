//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop

#include "Unit2.h"
#include "Unit1.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm2 *Form2; // Ваша форма
//---------------------------------------------------------------------------
__fastcall TForm2::TForm2(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------

void __fastcall TForm2::FormCreate(TObject *Sender)
{

	try
	{
		ADOConnection1->Connected = true;
	}
	catch (Exception &E)
	{
		ShowMessage("Помилка підключення до БД: " + E.Message + "\nПеревірте шлях до users_db.accdb та налаштування ADOConnection.");
		Application->Terminate();
	}
}
//---------------------------------------------------------------------------

void __fastcall TForm2::FormClose(TObject *Sender, TCloseAction &Action)
{
	if (ADOQuery1->Active) {
		ADOQuery1->Close();
	}
	if (ADOConnection1->Connected) {
		ADOConnection1->Close();
	}
}
//---------------------------------------------------------------------------

void __fastcall TForm2::Button1Click(TObject *Sender)
{
	AnsiString username = Edit1->Text.Trim();
	AnsiString password = Edit2->Text;

	if (username.IsEmpty() || password.IsEmpty()) {
        ShowMessage("Будь ласка, введіть логін та пароль.");
		return;
    }

    try
    {
		// Закриваємо запит, якщо він був відкритий
        if (ADOQuery1->Active) { // Використовуємо ваш ADOQuery1
            ADOQuery1->Close();
		}

        // Налаштовуємо SQL-запит для перевірки логіна та пароля
        ADOQuery1->SQL->Clear(); // Використовуємо ваш ADOQuery1
		// Використовуємо ваші назви таблиці 'User' та полів 'КодКористувача', 'Логін', 'Пароль'
		ADOQuery1->SQL->Add("SELECT Логін FROM [User] WHERE Логін = :Логін AND Пароль = :Пароль");
	   //	ADOQuery1->SQL->Add("WHERE Логін = :Логін AND Пароль = :Пароль");


		ADOQuery1->Parameters->ParamByName("Логін")->Value = username;
		ADOQuery1->Parameters->ParamByName("Пароль")->Value = password;


		ADOQuery1->Open();


        if (!ADOQuery1->Eof) {

			AnsiString loggedInUsername = ADOQuery1->Fields->FieldByName("Логін")->AsString;
            ShowMessage("Ласкаво просимо, " + loggedInUsername + "!");


        } else {
            ShowMessage("Невірний логін або пароль.");
        }
    }
	catch (Exception &E) // Обробка будь-яких винятків (помилок)
	{
		ShowMessage("Сталася помилка: " + E.Message);
    }

    if (ADOQuery1->Active) {
        ADOQuery1->Close();
    }
}
//---------------------------------------------------------------------------
void __fastcall TForm2::Button2Click(TObject *Sender)
{
	Form1->Show();
	Form2->Hide();
}
//---------------------------------------------------------------------------

